#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source $DIR/default_environment.sh

shapefiledir=$INSTALL_DIR/etc/mapserver/shapefiles

function load_shapefile {
   url=$1
   shapefilename=$2
   zipfile=$GIS_DATA_DIR/shapefiles/`echo $url | perl -pe 's/https?:\/\///'`

   if [ -f $zipfile ];
   then
       echo "already had $zipfile"
   else
       echo "need $zipfile"
       cd $GIS_DATA_DIR/shapefiles
       wget -N -x $url
   fi

   shapefile=$shapefiledir/$shapefilename

   if [ -f $shapefile ];
   then
       echo already had $shapefile
   else
       mkdir -p $shapefiledir
       unzip -n -j $zipfile -d $shapefiledir
   fi

}

load_shapefile http://data.openstreetmapdata.com/land-polygons-split-3857.zip  land_polygons.shp 
load_shapefile http://data.openstreetmapdata.com/simplified-land-polygons-complete-3857.zip simplified_land_polygons.shp
load_shapefile http://www2.census.gov/geo/tiger/GENZ2014/shp/cb_2014_us_state_20m.zip cb_2014_us_state_20m.shp

# Note that the shapefile cb_2014_us_state_20m.shp can not be used directly by mapserver,
# but if converted to another shapefile with the same information using ogr2ogr, it works.
[ -f $shapefiledir/states.shp ] || ogr2ogr -f "ESRI Shapefile"  $shapefiledir/states.shp  $shapefiledir/cb_2014_us_state_20m.shp
